---
Date: 2026-02-18
Author: "Claude | Model: claude-sonnet-4-6"
Version: v1.0
Status: Active
---

# Skill: Render Deployment

**Domain:** Infrastructure | **Tier:** Core
**Used by:** DevOps, Russell deployments
**Back to:** [[MOC-Core]] | [[MOC-Infrastructure]]

---

## What It Does

Manages BPR&D's Render deployment: the crewai-service FastAPI backend and the web frontend.

---

## Service Configuration

### crewai-service (Meeting Engine)
```yaml
# render-crewai.yaml
services:
  - type: web
    name: bprd-meeting-engine
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT
    plan: starter  # $7/month
    rootDir: crewai-service
    envVars:
      - key: GITHUB_TOKEN
        sync: false
      - key: XAI_API_KEY
        sync: false
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: GOOGLE_API_KEY
        sync: false
      - key: TELEGRAM_BOT_TOKEN
        sync: false
```

### Web Frontend
```yaml
# render.yaml (root)
services:
  - type: web
    name: bprd-web
    runtime: node
    buildCommand: npm install && npm run build
    startCommand: npm start
    rootDir: web
    plan: free
```

---

## Deploy Flow

```
1. Push to main branch
2. Render auto-detects render*.yaml files
3. Builds and deploys both services
4. Services live at:
   - bprd-meeting-engine.[render-url]
   - bprd-d.onrender.com (web)
```

For manual redeploy: Use Render dashboard → Manual Deploy.

---

## APScheduler Inside FastAPI

The Meeting Engine's scheduler runs INSIDE the FastAPI process (no external cron):
```python
# crewai-service/main.py
from apscheduler.schedulers.asyncio import AsyncIOScheduler

scheduler = AsyncIOScheduler()
scheduler.add_job(
    run_daily_briefing,
    'cron',
    hour=7,
    minute=47,
    timezone='US/Pacific',
    day_of_week='mon-fri'
)
scheduler.start()
```

**Note:** On Render Starter, the service sleeps after 15 min inactivity. APScheduler keeps it alive via scheduled jobs. If all jobs fail, the service sleeps and misses the next scheduled job. Keep-alive ping endpoint is recommended for production.

---

## Environment Variables

| Variable | Purpose |
|----------|---------|
| `GITHUB_TOKEN` | Read/write to REBEmpire/BPR-D |
| `XAI_API_KEY` | Grok (xAI API) |
| `ANTHROPIC_API_KEY` | Claude |
| `GOOGLE_API_KEY` | Gemini |
| `ABACUS_API_KEY` | Abacus (active after Feb 23) |
| `TELEGRAM_BOT_TOKEN` | Alerts to Russell |
| `TELEGRAM_CHAT_ID` | Russell's chat ID |

---

## Known Issues

- **Cold starts:** Render Starter has cold start delay (~10s) after sleep. Daily briefing at 07:47 may be delayed.
- **Mitigation:** Health check ping every 10min (simple GET /) to keep warm.
- **Long-term fix:** Upgrade to Render Standard if cold starts cause missed meetings.

---

## Related Skills

- [[skill-work-session-automation]] — APScheduler job definitions
- [[skill-meeting-engine]] — the FastAPI endpoint that executes sessions
- [[skill-cost-governance]] — $7/month Render cost (outside $20 API budget)
- [[skill-github-commit-automation]] — GitHub token used by this service
- [[skill-telegram-alerts]] — Telegram config on this service

---

*Generated by: Claude | Model: claude-sonnet-4-6 | 2026-02-18*
